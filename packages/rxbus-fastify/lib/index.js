var e,n=require("fastify-websocket"),s=(e=require("fastify"))&&e.__esModule?e.default:e,{Bus:r}=require("@soulsoftware/rxbus");function t(e,n,s){return n in e?Object.defineProperty(e,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[n]=s,e}const a=new class{constructor(){t(this,"server",s({})),t(this,"name","fastify"),t(this,"channelName",`${this.name}/channel`)}onRegister(){this.server.register(n),this._myChannel=r.channels.newChannel(this.channelName);const e=new RegExp(`/${this.channelName}/([\\w]+)([?].+)?`);this.server.get(`/${this.channelName}/*`,((n,s)=>{const r=e.exec(n.url);var t;r&&(null===(t=this._myChannel)||void 0===t||t.next({command:r[1],data:n.query}));s.status(200).send(JSON.stringify(n.query))}))}onStart(){this.server.listen(8080,((e,n)=>{e?console.error(e):console.log(`Server listening at ${n}`)}))}onStop(){this.server.close().then((e=>console.log("server closed!")))}};exports.Module=a;